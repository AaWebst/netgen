<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEP1445 Traffic Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        header h1 {
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        header p {
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid #334155;
        }
        
        .card h2 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #334155;
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 0.9em;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #10b981;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-running {
            background: #10b981;
            color: white;
        }
        
        .status-stopped {
            background: #ef4444;
            color: white;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        
        .controls {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }
        
        th {
            background: #0f172a;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background: #334155;
        }
        
        .profile-enabled {
            color: #10b981;
            font-weight: 600;
        }
        
        .profile-disabled {
            color: #64748b;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        input, select {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #334155;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 1em;
            width: 100%;
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #94a3b8;
            font-weight: 500;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #10b98120;
            border: 1px solid #10b981;
            color: #10b981;
        }
        
        .alert-error {
            background: #ef444420;
            border: 1px solid #ef4444;
            color: #ef4444;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üöÄ VEP1445 Traffic Generator</h1>
            <p>Enterprise Network Traffic Generation & Testing Platform</p>
        </div>
    </header>

    <div class="container">
        <!-- System Stats Dashboard -->
        <div class="dashboard">
            <div class="card">
                <h2>System Status</h2>
                <div class="stat">
                    <span class="stat-label">Status</span>
                    <span class="status-badge" id="status-badge">STOPPED</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Interfaces</span>
                    <span class="stat-value" id="stat-interfaces">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Active Profiles</span>
                    <span class="stat-value" id="stat-profiles">0</span>
                </div>
            </div>

            <div class="card">
                <h2>Traffic Stats</h2>
                <div class="stat">
                    <span class="stat-label">Packets Sent</span>
                    <span class="stat-value" id="stat-packets">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Bytes Sent</span>
                    <span class="stat-value" id="stat-bytes">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Connections</span>
                    <span class="stat-value" id="stat-connections">0</span>
                </div>
            </div>

            <div class="card">
                <h2>Performance</h2>
                <div class="stat">
                    <span class="stat-label">TCP Pool Usage</span>
                    <span class="stat-value" id="stat-pool">0%</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Active TCP</span>
                    <span class="stat-value" id="stat-tcp-active">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">PPS Rate</span>
                    <span class="stat-value" id="stat-pps">0</span>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="card">
            <h2>Traffic Control</h2>
            <div class="controls">
                <button class="btn btn-success" onclick="startTraffic()">‚ñ∂ Start Traffic</button>
                <button class="btn btn-danger" onclick="stopTraffic()">‚èπ Stop Traffic</button>
                <button class="btn btn-secondary" onclick="resetStats()">üîÑ Reset Stats</button>
                <button class="btn btn-primary" onclick="autoDetect()">üîç Auto-Detect</button>
            </div>
        </div>

        <!-- Interfaces -->
        <div class="section">
            <div class="card">
                <h2>Network Interfaces</h2>
                <table id="interfaces-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>IP Address</th>
                            <th>MAC Address</th>
                            <th>Network</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="interfaces-tbody">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #64748b;">
                                No interfaces detected. Click "Auto-Detect" to scan.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Profiles -->
        <div class="section">
            <div class="card">
                <h2>Traffic Profiles</h2>
                <table id="profiles-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Source ‚Üí Dest</th>
                            <th>Bandwidth</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="profiles-tbody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #64748b;">
                                No profiles defined. Click "Auto-Detect" to generate profiles.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let updateInterval;

        // Format numbers
        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'G';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toString();
        }

        // Update dashboard
        async function updateDashboard() {
            try {
                // Get stats
                const statsResp = await fetch(`${API_BASE}/stats`);
                const statsData = await statsResp.json();
                
                if (statsData.success) {
                    const stats = statsData.stats;
                    
                    // Update status badge
                    const badge = document.getElementById('status-badge');
                    if (statsData.running) {
                        badge.textContent = 'RUNNING';
                        badge.className = 'status-badge status-running';
                    } else {
                        badge.textContent = 'STOPPED';
                        badge.className = 'status-badge status-stopped';
                    }
                    
                    // Update stats
                    document.getElementById('stat-packets').textContent = formatNumber(stats.packets_sent);
                    document.getElementById('stat-bytes').textContent = formatNumber(stats.bytes_sent);
                    document.getElementById('stat-connections').textContent = formatNumber(stats.connections_created);
                    
                    if (stats.tcp_pool_utilization !== undefined) {
                        document.getElementById('stat-pool').textContent = stats.tcp_pool_utilization.toFixed(1) + '%';
                    }
                    if (stats.tcp_active !== undefined) {
                        document.getElementById('stat-tcp-active').textContent = formatNumber(stats.tcp_active);
                    }
                }

                // Get interfaces
                const ifacesResp = await fetch(`${API_BASE}/interfaces`);
                const ifacesData = await ifacesResp.json();
                
                if (ifacesData.success) {
                    updateInterfacesTable(ifacesData.interfaces);
                    document.getElementById('stat-interfaces').textContent = ifacesData.interfaces.length;
                }

                // Get profiles
                const profilesResp = await fetch(`${API_BASE}/profiles`);
                const profilesData = await profilesResp.json();
                
                if (profilesData.success) {
                    updateProfilesTable(profilesData.profiles);
                    const activeCount = profilesData.profiles.filter(p => p.enabled).length;
                    document.getElementById('stat-profiles').textContent = activeCount;
                }
            } catch (error) {
                console.error('Update failed:', error);
            }
        }

        // Update interfaces table
        function updateInterfacesTable(interfaces) {
            const tbody = document.getElementById('interfaces-tbody');
            
            if (interfaces.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">No interfaces detected.</td></tr>';
                return;
            }
            
            tbody.innerHTML = interfaces.map(iface => `
                <tr>
                    <td>${iface.name}</td>
                    <td>${iface.ip || 'N/A'}</td>
                    <td>${iface.mac || 'N/A'}</td>
                    <td>${iface.network || 'N/A'}</td>
                    <td><span class="status-badge status-running">${iface.status}</span></td>
                </tr>
            `).join('');
        }

        // Update profiles table
        function updateProfilesTable(profiles) {
            const tbody = document.getElementById('profiles-tbody');
            
            if (profiles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #64748b;">No profiles defined.</td></tr>';
                return;
            }
            
            tbody.innerHTML = profiles.map(profile => `
                <tr>
                    <td>${profile.name}</td>
                    <td>${profile.type.toUpperCase()}</td>
                    <td>${profile.src_interface} ‚Üí ${profile.dst_interface}</td>
                    <td>${profile.bandwidth_mbps || 'N/A'} Mbps</td>
                    <td>
                        <span class="${profile.enabled ? 'profile-enabled' : 'profile-disabled'}">
                            ${profile.enabled ? '‚úì Enabled' : '‚óã Disabled'}
                        </span>
                    </td>
                    <td>
                        ${profile.enabled ? 
                            `<button class="btn btn-danger" onclick="toggleProfile('${profile.id}', false)" style="padding: 6px 12px;">Disable</button>` :
                            `<button class="btn btn-success" onclick="toggleProfile('${profile.id}', true)" style="padding: 6px 12px;">Enable</button>`
                        }
                    </td>
                </tr>
            `).join('');
        }

        // Control functions
        async function startTraffic() {
            try {
                const resp = await fetch(`${API_BASE}/traffic/start`, { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    showAlert('Traffic generation started!', 'success');
                } else {
                    showAlert('Failed to start: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }

        async function stopTraffic() {
            try {
                const resp = await fetch(`${API_BASE}/traffic/stop`, { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    showAlert('Traffic generation stopped!', 'success');
                } else {
                    showAlert('Failed to stop: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }

        async function resetStats() {
            try {
                const resp = await fetch(`${API_BASE}/stats/reset`, { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    showAlert('Statistics reset!', 'success');
                    updateDashboard();
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }

        async function autoDetect() {
            try {
                showAlert('Detecting interfaces...', 'success');
                const resp = await fetch(`${API_BASE}/auto-detect`, { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    showAlert(`Detected ${data.interfaces} interfaces and generated ${data.profiles} profiles!`, 'success');
                    updateDashboard();
                } else {
                    showAlert('Auto-detect failed: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }

        async function toggleProfile(profileId, enable) {
            try {
                const action = enable ? 'enable' : 'disable';
                const resp = await fetch(`${API_BASE}/profiles/${profileId}/${action}`, { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    updateDashboard();
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            document.querySelector('.container').insertBefore(alert, document.querySelector('.dashboard'));
            setTimeout(() => alert.remove(), 3000);
        }

        // Start auto-update
        updateDashboard();
        updateInterval = setInterval(updateDashboard, 1000);
    </script>
</body>
</html>
